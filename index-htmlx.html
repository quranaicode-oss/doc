<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mishkah HTMLx Playground</title>
    <meta
      name="description"
      content="Interactive Mishkah HTMLx playground to demonstrate the secure evaluator fix."
    />
    <script src="https://cdn.jsdelivr.net/npm/acorn@8/dist/acorn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/acorn-walk@8/dist/walk.min.js" defer></script>
    <script src="./mishkah-htmlx.js" defer></script>
    <style>
      :root {
        color-scheme: light dark;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        --accent: #006cbe;
        --accent-soft: rgba(0, 108, 190, 0.08);
        --border: rgba(0, 0, 0, 0.12);
        --shadow: rgba(0, 0, 0, 0.12);
        background-color: #f7f9fb;
      }

      body {
        margin: 0;
        padding: 2rem 1rem 3rem;
        display: flex;
        justify-content: center;
        background: linear-gradient(135deg, #ffffff 0%, #f1f5fb 45%, #ebf4ff 100%);
      }

      main {
        width: min(960px, 100%);
        background-color: #ffffff;
        border-radius: 16px;
        box-shadow: 0 18px 48px var(--shadow);
        padding: 2.5rem;
        border: 1px solid var(--border);
      }

      h1 {
        margin-top: 0;
        font-size: clamp(1.8rem, 2.8vw, 2.6rem);
        color: #0b2f4c;
      }

      p.lead {
        font-size: clamp(1rem, 2vw, 1.2rem);
        margin-bottom: 1.5rem;
        line-height: 1.7;
        color: #24384f;
      }

      section.card {
        border-radius: 12px;
        border: 1px solid var(--border);
        padding: 1.5rem;
        margin-bottom: 2rem;
        background-color: #ffffff;
      }

      section.card h2 {
        margin-top: 0;
        color: #103960;
      }

      ul.checklist {
        list-style: none;
        margin: 0;
        padding: 0;
        display: grid;
        gap: 0.75rem;
      }

      ul.checklist li {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        border-radius: 10px;
        background-color: var(--accent-soft);
        color: #114369;
      }

      ul.checklist span.icon {
        width: 1.6rem;
        height: 1.6rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background-color: #ffffff;
        border: 1px solid rgba(0, 0, 0, 0.08);
        font-weight: bold;
        color: var(--accent);
      }

      .locale-note {
        font-size: 0.95rem;
        color: #3a4c61;
        margin-top: 2rem;
        padding: 1rem;
        border-radius: 10px;
        background: linear-gradient(135deg, rgba(0, 108, 190, 0.08), rgba(0, 108, 190, 0.02));
      }

      code {
        background-color: rgba(15, 23, 42, 0.08);
        padding: 0.1rem 0.45rem;
        border-radius: 6px;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Mishkah HTMLx Playground · ساحة تجريبية لـ Mishkah HTMLx</h1>
      <p class="lead">
        This page mirrors the secure evaluator fix that already exists in the V2 build
        and ensures both acorn and acorn-walk are loaded before <code>mishkah-htmlx.js</code>.
        يعرض هذا المثال نفس الإصلاح الموجود في الإصدار الثاني ويتأكد من تحميل مكتبات
        <code>acorn</code> و<code>acorn-walk</code> قبل ملف <code>mishkah-htmlx.js</code>.
      </p>

      <section id="greeting-card" class="card"></section>

      <section class="locale-note" id="locale-note"></section>
    </main>

    <template id="greeting-template">
      <section class="card">
        <h2>{{ heading }}</h2>
        <p>{{ intro }}</p>
        <ul class="checklist">
          {{{ checklistHtml }}}
        </ul>
      </section>
    </template>

    <template id="locale-template">
      <p>
        <strong>{{ localeTitle }}</strong><br />
        {{ localeMessage }}
      </p>
    </template>

    <script>
      window.addEventListener('DOMContentLoaded', function () {
        var checklistItems = [
          {
            icon: '✓',
            textEn: 'Load <acorn> from the CDN before Mishkah HTMLx.',
            textAr: 'تحميل <acorn> من شبكة CDN قبل ملف Mishkah HTMLx.'
          },
          {
            icon: '✓',
            textEn: 'Load <acorn-walk> immediately after acorn.',
            textAr: 'تحميل <acorn-walk> مباشرة بعد acorn.'
          },
          {
            icon: '✓',
            textEn: 'Reference <code>./mishkah-htmlx.js</code> from the project root only.',
            textAr: 'استخدام المسار <code>./mishkah-htmlx.js</code> من الجذر فقط.'
          }
        ];

        var checklistHtml = checklistItems
          .map(function (item) {
            var text = item.textEn + ' / ' + item.textAr;
            return (
              '<li><span class="icon">' +
              item.icon +
              '</span><span>' +
              MishkahHTMLx.escape(text) +
              '</span></li>'
            );
          })
          .join('');

        var greetingContext = {
          heading: 'Secure HTMLx Setup · إعداد HTMLx الآمن',
          intro:
            'You are now using the unified Mishkah HTMLx bundle safely. يمكنك الآن استخدام مكتبة Mishkah HTMLx من المسار الموحد بأمان.',
          checklistHtml: checklistHtml
        };

        MishkahHTMLx.mount('greeting-template', '#greeting-card', greetingContext);

        var localeContext = {
          localeTitle: 'Dual Language Note · ملاحظة ثنائية اللغة',
          localeMessage:
            'The demo keeps every explanation bilingual as required. يحافظ العرض التوضيحي على الشرح باللغتين كما هو مطلوب.'
        };

        MishkahHTMLx.mount('locale-template', '#locale-note', localeContext);
      });
    </script>
  </body>
</html>
